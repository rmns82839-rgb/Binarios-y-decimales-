<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor Num√©rico Taller</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- CSS Global --- */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            padding: 10px;
            text-align: center;
        }

        h1,
        h2 {
            color: #333;
            margin-top: 10px;
        }

        .converter-section,
        .header-section,
        .input-group {
            max-width: 800px;
            margin: 15px auto;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-section {
            background-color: #e3f2fd;
        }

        input[type="number"],
        input[type="text"],
        input[type="date"] {
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Contenedor flexible para los nuevos campos */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        @media (min-width: 600px) {
            .info-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Botones */
        button {
            padding: 10px 15px;
            margin: 8px 5px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .add-btn {
            background-color: #007bff;
            color: white;
            width: 100%;
        }

        .convert-btn {
            background-color: #4CAF50;
            color: white;
            width: 30%;
        }

        /* NUEVOS ESTILOS */
        .clear-btn {
            background-color: #ffc107;
            color: #333;
            width: 98%;
        }
        
        .refresh-btn {
            background-color: #6c757d;
            color: white;
            width: 48%;
            margin-top: 10px;
        }

        .link-btn {
            background-color: #17a2b8;
            color: white;
            width: 48%;
            margin-top: 10px;
        }
        /* FIN NUEVOS ESTILOS */

        .pdf-btn {
            background-color: #dc3545;
            color: white;
            margin-top: 20px;
            width: 98%;
        }

        .resultado {
            margin-top: 10px;
            font-size: 1.1em;
            font-weight: normal;
            color: #007bff;
        }

        .conversion-result {
            padding: 15px 0;
            border-top: 1px solid #eee;
            margin-top: 15px;
            /* Evitar cortes de p√°gina en el contenedor del resultado */
            page-break-inside: avoid;
            break-inside: avoid;
        }

        /* Contenedor de la tabla */
        .proceso-table-container {
            overflow-x: auto;
            padding-bottom: 5px;
        }

        /* --- CSS para Tablas y Formato --- */
        table {
            break-inside: avoid;
            page-break-inside: avoid;
            min-width: 500px;
            width: 100%;
            margin: 10px 0;
            border-collapse: collapse;
            font-size: 0.75em;
            text-align: center;
            transform-origin: top left;
            transform: scale(0.85);
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 5px;
            white-space: nowrap;
        }

        th {
            background-color: #e0f7fa;
            color: #000;
            font-weight: bold;
        }

        /* ESTILO PARA LA "ZONA VERDE" DE RESIDUOS (GENERAL) */
        .residuo-col {
            background-color: #c8e6c9;
        }


        /* **ZONA VERDE M√ÅS OSCURA para el MSB (√∫ltimo residuo)** */
        .residuo-col.dec-bin-msb {
            font-weight: bolder;
            background-color: #a3d7a4;
            font-size: 1.1em;
        }

        /* Ajuste de la tabla Binario a Decimal */
        .bin-to-dec-table th {
            background-color: #ffe0b2;
        }

        hr {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
            margin: 30px 0;
        }

        .conversion-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .conversion-input input {
            width: 65%;
        }

        @media (min-width: 600px) {
            .conversion-input input {
                width: 70%;
            }

            table {
                transform: scale(1);
                font-size: 0.9em;
            }
        }
    </style>

</head>

<body onload="loadData()">
    <h1>Conversor Num√©rico para Taller</h1>

    <section class="header-section">
        <h2>Datos del Taller</h2>
        <input type="text" id="tallerInput" value="Taller 2 de √Ålgebra Lineal" placeholder="T√≠tulo del Taller" oninput="saveData()">
        <input type="date" id="fechaInput" value="2025-10-25" oninput="saveData()">
        <input type="text" id="institucionInput" placeholder="Instituci√≥n (ej: Polit√©cnico)" oninput="saveData()">

        <div class="info-grid">
            <input type="text" id="programaInput" placeholder="Programa (ej: Ingenier√≠a de Sistemas)" oninput="saveData()">
            <input type="text" id="jornadaInput" placeholder="Jornada (ej: Nocturna)" oninput="saveData()">
            <input type="number" id="cicloInput" placeholder="Ciclo Cursado (ej: 4)" oninput="saveData()">
        </div>

        <h3>Realizado Por</h3>
        <div id="integrantesContainer">
            <input type="text" name="integrante" class="integrante-input" placeholder="Nombre del Integrante 1 (ej: Iv√°n)" oninput="saveData()">
        </div>
        <button class="add-btn" onclick="agregarIntegrante()">+ Adicionar otro Integrante</button>
        
        <button class="refresh-btn" onclick="refrescarPagina()">üîÑ Refrescar y Limpiar Todo</button>
       <a href="https://rmns82839-rgb.github.io/subredes/" class="link-btn" style="text-decoration: none; display: inline-block;">
    <button class="link-btn" style="width: 100%; margin: 0;">üåê Ir a Conversor de Subredes</button>
</a>
        </section>
    <hr>

    <section class="converter-section">
        <h2>Decimal a Binario</h2>
        <div id="decToBinInputs">
            <div class="conversion-input">
                <input type="number" class="decimal-input" placeholder="Decimal #1 (ej. 530)" oninput="saveData()">
                <button class="convert-btn" onclick="convertDecimalToBinary(this)">Calcular</button>
            </div>
        </div>
        <button class="add-btn" onclick="agregarInput('decToBin')">+ Agregar otro n√∫mero decimal</button>
        <button class="clear-btn" onclick="limpiarResultados('decToBin')">üßπ Limpiar Resultados de Decimal a Binario</button>
        <div id="resultadosDecimalABinario" class="pdf-content"></div>
    </section>
    <hr>
    <section class="converter-section">
        <h2>Binario a Decimal</h2>
        <div id="binToDecInputs">
            <div class="conversion-input">
                <input type="text" class="binary-input" placeholder="Binario #1 (ej. 1100111)" oninput="saveData()">
                <button class="convert-btn" onclick="convertBinaryToDecimal(this)">Calcular</button>
            </div>
        </div>
        <button class="add-btn" onclick="agregarInput('binToDec')">+ Agregar otro n√∫mero binario</button>
        <button class="clear-btn" onclick="limpiarResultados('binToDec')">üßπ Limpiar Resultados de Binario a Decimal</button>
        <div id="resultadosBinarioADecimal" class="pdf-content"></div>
    </section>

    <hr>

    <button class="pdf-btn" onclick="generarPDF()">Generar un √önico PDF con Todos los Resultados</button>
    <script>
        // --- JAVASCRIPT: Persistencia y L√≥gica de UI ---

        let inputCounterDec = 1;
        let inputCounterBin = 1;

        // ** FUNCI√ìN PARA GUARDAR DATOS EN localStorage **
        function saveData() {
            const data = {
                // 1. Datos del Encabezado
                taller: document.getElementById('tallerInput').value,
                fecha: document.getElementById('fechaInput').value,
                institucion: document.getElementById('institucionInput').value,
                programa: document.getElementById('programaInput').value,
                jornada: document.getElementById('jornadaInput').value,
                ciclo: document.getElementById('cicloInput').value,

                // 2. Integrantes
                integrantes: Array.from(document.querySelectorAll('.integrante-input')).map(input => input.value),

                // 3. Inputs Decimal
                decInputs: Array.from(document.querySelectorAll('#decToBinInputs .decimal-input')).map(input => input.value),

                // 4. Inputs Binario
                binInputs: Array.from(document.querySelectorAll('#binToDecInputs .binary-input')).map(input => input.value),
            };
            try {
                localStorage.setItem('tallerConversionesData', JSON.stringify(data));
            } catch (e) {
                console.error("Error al guardar en localStorage:", e);
            }
        }

        // ** FUNCI√ìN PARA CARGAR DATOS DESDE localStorage **
        function loadData() {
            try {
                const storedData = localStorage.getItem('tallerConversionesData');
                if (!storedData) return;

                const data = JSON.parse(storedData);

                // 1. Cargar Datos del Encabezado
                document.getElementById('tallerInput').value = data.taller || '';
                document.getElementById('fechaInput').value = data.fecha || '';
                document.getElementById('institucionInput').value = data.institucion || '';
                document.getElementById('programaInput').value = data.programa || '';
                document.getElementById('jornadaInput').value = data.jornada || '';
                document.getElementById('cicloInput').value = data.ciclo || '';

                // 2. Cargar Integrantes
                const integrantesContainer = document.getElementById('integrantesContainer');
                integrantesContainer.innerHTML = ''; // Limpiar entradas predeterminadas

                if (data.integrantes && data.integrantes.length > 0) {
                    data.integrantes.forEach((name, index) => {
                        const newInput = document.createElement('input');
                        newInput.type = 'text';
                        newInput.name = 'integrante';
                        newInput.className = 'integrante-input';
                        newInput.placeholder = `Nombre del Integrante ${index + 1}`;
                        newInput.value = name;
                        newInput.oninput = saveData; // Asegurar que el listener se aplique
                        integrantesContainer.appendChild(newInput);
                    });
                } else {
                    // Si no hay datos, dejar el input predeterminado
                    agregarIntegrante(1);
                }


                // 3. Cargar Inputs Decimales
                const decInputsContainer = document.getElementById('decToBinInputs');
                decInputsContainer.innerHTML = '';
                if (data.decInputs && data.decInputs.length > 0) {
                    data.decInputs.forEach((value, index) => {
                        const count = index + 1;
                        const newDiv = document.createElement('div');
                        newDiv.className = 'conversion-input';
                        newDiv.innerHTML = `
                            <input type="number" class="decimal-input" placeholder="Decimal #${count}" value="${value}" oninput="saveData()">
                            <button class="convert-btn" onclick="convertDecimalToBinary(this)">Calcular</button>
                        `;
                        decInputsContainer.appendChild(newDiv);
                        inputCounterDec = count;

                        // Si el valor no est√° vac√≠o, recalcular para mostrar el resultado
                        if (value) {
                            convertDecimalToBinary(newDiv.querySelector('.convert-btn'));
                        }
                    });
                } else {
                    // Crear el primer input si no hay datos
                    agregarInput('decToBin', 1);
                }

                // 4. Cargar Inputs Binarios
                const binInputsContainer = document.getElementById('binToDecInputs');
                binInputsContainer.innerHTML = '';
                if (data.binInputs && data.binInputs.length > 0) {
                    data.binInputs.forEach((value, index) => {
                        const count = index + 1;
                        const newDiv = document.createElement('div');
                        newDiv.className = 'conversion-input';
                        newDiv.innerHTML = `
                            <input type="text" class="binary-input" placeholder="Binario #${count}" value="${value}" oninput="saveData()">
                            <button class="convert-btn" onclick="convertBinaryToDecimal(this)">Calcular</button>
                        `;
                        binInputsContainer.appendChild(newDiv);
                        inputCounterBin = count;

                        // Si el valor no est√° vac√≠o, recalcular para mostrar el resultado
                        if (value) {
                            convertBinaryToDecimal(newDiv.querySelector('.convert-btn'));
                        }
                    });
                } else {
                    // Crear el primer input si no hay datos
                    agregarInput('binToDec', 1);
                }

            } catch (e) {
                console.error("Error al cargar desde localStorage:", e);
                // Si hay un error, limpiar y empezar de nuevo para evitar bucles
                localStorage.removeItem('tallerConversionesData');
            }
        }

        // Modificaci√≥n de agregarInput para permitir carga inicial
        function agregarInput(tipo, initialCount = 0) {
            const container = document.getElementById(tipo === 'decToBin' ? 'decToBinInputs' : 'binToDecInputs');

            if (initialCount === 0) {
                if (tipo === 'decToBin') {
                    inputCounterDec++;
                } else {
                    inputCounterBin++;
                }
            }

            const count = initialCount > 0 ? initialCount : (tipo === 'decToBin' ? inputCounterDec : inputCounterBin);

            const newDiv = document.createElement('div');
            newDiv.className = 'conversion-input';

            if (tipo === 'decToBin') {
                newDiv.innerHTML = `
                    <input type="number" class="decimal-input" placeholder="Decimal #${count}" oninput="saveData()">
                    <button class="convert-btn" onclick="convertDecimalToBinary(this)">Calcular</button>
                `;
            } else {
                newDiv.innerHTML = `
                    <input type="text" class="binary-input" placeholder="Binario #${count}" oninput="saveData()">
                    <button class="convert-btn" onclick="convertBinaryToDecimal(this)">Calcular</button>
                `;
            }
            container.appendChild(newDiv);
        }

        // Modificaci√≥n de agregarIntegrante para permitir carga inicial
        function agregarIntegrante(initialCount = 0) {
            const container = document.getElementById('integrantesContainer');
            const newCount = initialCount > 0 ? initialCount : container.querySelectorAll('.integrante-input').length + 1;
            const newInput = document.createElement('input');
            newInput.type = 'text';
            newInput.name = 'integrante';
            newInput.className = 'integrante-input';
            newInput.placeholder = `Nombre del Integrante ${newCount}`;
            newInput.oninput = saveData; // Asegurar que guarda al teclear
            container.appendChild(newInput);
        }

        function isPositiveInteger(value) {
            return !isNaN(value) && parseInt(Number(value)) === Number(value) && value >= 0;
        }

        // **√öNICO PUNTO DE RENDERIZADO**
        function actualizarResultados(tipo) {
            const container = document.getElementById(tipo === 'decToBin' ? 'resultadosDecimalABinario' : 'resultadosBinarioADecimal');
            const inputElements = document.querySelectorAll(tipo === 'decToBin' ? '#decToBinInputs .conversion-input' : '#binToDecInputs .conversion-input');

            let allResultsHTML = '';
            // Se asume que el outputContainer (result-output) est√° inmediatamente despu√©s del inputGroup (conversion-input)
            inputElements.forEach(inputGroup => {
                let resultDiv = inputGroup.nextElementSibling;
                // Buscar el result-output que se a√±adi√≥ din√°micamente
                while (resultDiv && !resultDiv.classList.contains('result-output')) {
                    resultDiv = resultDiv.nextElementSibling;
                }

                if (resultDiv && resultDiv.classList.contains('result-output') && resultDiv.innerHTML.includes('conversion-result')) {
                    allResultsHTML += resultDiv.innerHTML;
                    allResultsHTML += '<hr style="border-top: 1px dotted #ccc; margin: 30px 0;">';
                }
            });

            if (allResultsHTML.endsWith('<hr style="border-top: 1px dotted #ccc; margin: 30px 0;">')) {
                allResultsHTML = allResultsHTML.slice(0, -56); // Eliminar el √∫ltimo HR
            }
            container.innerHTML = allResultsHTML;
        }


        // --- NUEVA FUNCI√ìN: Limpiar resultados de una secci√≥n ---
        function limpiarResultados(tipo) {
            const containerId = tipo === 'decToBin' ? 'decToBinInputs' : 'binToDecInputs';
            const inputElements = document.querySelectorAll(`#${containerId} .conversion-input`);

            // Eliminar los contenedores de resultado din√°micos
            inputElements.forEach(inputGroup => {
                let resultDiv = inputGroup.nextElementSibling;
                while (resultDiv && !resultDiv.classList.contains('result-output')) {
                    resultDiv = resultDiv.nextElementSibling;
                }
                if (resultDiv && resultDiv.classList.contains('result-output')) {
                    resultDiv.remove();
                }
                // Limpiar el valor del input para que no se recargue el resultado
                inputGroup.querySelector('input').value = '';
            });

            // Llamar a actualizarResultados para limpiar el contenedor principal
            actualizarResultados(tipo);
            saveData(); // Guardar el estado sin resultados y con inputs vac√≠os
            alert(`‚úÖ Resultados de ${tipo === 'decToBin' ? 'Decimal a Binario' : 'Binario a Decimal'} limpiados. Los inputs tambi√©n han sido vaciados.`);
        }

        // --- NUEVA FUNCI√ìN: Refrescar la p√°gina completamente ---
        function refrescarPagina() {
            if (confirm('‚ö†Ô∏è ¬øEst√°s seguro que deseas refrescar la p√°gina? Esto borrar√° TODOS los datos y resultados guardados.')) {
                localStorage.removeItem('tallerConversionesData'); // Eliminar todos los datos guardados
                window.location.reload(); // Recargar la p√°gina
            }
        }


        // --- 1. Decimal a Binario (Divisiones Sucesivas) ---
        function convertDecimalToBinary(button) {
            const input = button.previousElementSibling;
            const decimal = parseFloat(input.value);
            const inputGroup = button.parentElement;

            let outputContainer = inputGroup.nextElementSibling;
            // Buscar el result-output, si no existe, crearlo
            while (outputContainer && !outputContainer.classList.contains('result-output')) {
                outputContainer = outputContainer.nextElementSibling;
            }

            if (!outputContainer || !outputContainer.classList.contains('result-output')) {
                outputContainer = document.createElement('div');
                outputContainer.className = 'result-output';
                outputContainer.style.display = 'none'; // Se mantiene oculto
                inputGroup.after(outputContainer);
            }

            if (!isPositiveInteger(decimal)) {
                outputContainer.innerHTML = '<div class="resultado" style="color:#dc3545;">‚ö†Ô∏è Decimal entero positivo inv√°lido.</div>';
                actualizarResultados('decToBin');
                saveData();
                return;
            }

            let n = parseInt(decimal);
            const pasos = [];
            let binario = '';

            if (decimal === 0) {
                binario = '0';
                pasos.push({
                    numero: 0,
                    divididoEntre2: 0,
                    residuo: 0
                });
            } else {
                while (n > 0) {
                    const residuo = n % 2;
                    const cociente = Math.floor(n / 2);
                    pasos.push({
                        numero: n,
                        divididoEntre2: cociente,
                        residuo: residuo
                    });
                    binario = residuo + binario;
                    n = cociente;
                }
            }

            let tablaHTML = '<div class="conversion-result">';
            tablaHTML += `<div class="resultado" style="margin-bottom: 10px;">${decimal}<sub>(10)</sub> = ${binario}<sub>(2)</sub></div>`;
            tablaHTML += '<p style="font-weight: bold; margin: 15px 0 5px;">Procedimiento (Lectura: de abajo hacia arriba):</p>';

            tablaHTML += '<div class="proceso-table-container">';
            tablaHTML += '<table style="min-width: 500px;">';
            tablaHTML += '<thead><tr><th>N√öMERO</th><th>DIVIDIDO ENTRE 2</th><th class="residuo-col">RESIDUO</th></tr></thead>';
            tablaHTML += '<tbody>';

            // Invertir el orden de iteraci√≥n para la visualizaci√≥n del resultado (de m√°s reciente a m√°s antiguo, aunque la tabla se lee de arriba a abajo)
            for (let i = 0; i < pasos.length; i++) {
                const paso = pasos[i];
                let residuoCellContent = paso.residuo;
                let residuoCellClass = 'residuo-col';

                // El MSB (Most Significant Bit) es el cociente final (o el √∫ltimo residuo antes de que el cociente sea 0)
                // En la tabla, este es el √∫ltimo paso, que corresponde al primer d√≠gito del binario.
                if (i === pasos.length - 1) { // El √∫ltimo paso de la divisi√≥n es el MSB
                    residuoCellClass += ' dec-bin-msb';
                }

                tablaHTML += `<tr><td>${paso.numero}</td><td>${paso.divididoEntre2}</td><td class="${residuoCellClass}">${residuoCellContent}</td></tr>`;
            }

            tablaHTML += '</tbody>';
            tablaHTML += '</table>';
            tablaHTML += '</div>';
            tablaHTML += '</div>';

            outputContainer.innerHTML = tablaHTML;
            actualizarResultados('decToBin');
            saveData();
        }


        // --- 2. Binario a Decimal (Suma de Potencias) ---
        function convertBinaryToDecimal(button) {
            const input = button.previousElementSibling;
            const binarioStr = input.value.trim();
            const inputGroup = button.parentElement;

            let outputContainer = inputGroup.nextElementSibling;
            // Buscar el result-output, si no existe, crearlo
            while (outputContainer && !outputContainer.classList.contains('result-output')) {
                outputContainer = outputContainer.nextElementSibling;
            }

            if (!outputContainer || !outputContainer.classList.contains('result-output')) {
                outputContainer = document.createElement('div');
                outputContainer.className = 'result-output';
                outputContainer.style.display = 'none';
                inputGroup.after(outputContainer);
            }

            if (!/^[01]+$/.test(binarioStr) || binarioStr === '') {
                outputContainer.innerHTML = '<div class="resultado" style="color:#dc3545;">‚ö†Ô∏è Binario inv√°lido (solo 0s y 1s).</div>';
                actualizarResultados('binToDec');
                saveData();
                return;
            }

            const nBits = binarioStr.length;
            let decimal = 0;
            let sumaParcial = '';

            let tablaHTML = '<div class="conversion-result">';
            let filaPotencia = '<tr><th>Potencia</th>';
            let filaValorPotencia = '<tr><th>Resultado</th>';
            let filaBinario = '<tr><th>Binario</th>';
            let filaParcial = '<tr><th class="residuo-col">Parcial</th>';

            for (let i = 0; i < nBits; i++) {
                // El d√≠gito m√°s a la derecha (LSB) corresponde a la potencia 2^0 (i=0)
                const digito = parseInt(binarioStr[nBits - 1 - i]);
                const potencia = i;
                const valorPotencia = Math.pow(2, potencia);
                const resultadoParcial = digito * valorPotencia;

                filaPotencia += `<td>2<sup>${potencia}</sup></td>`;
                filaValorPotencia += `<td>${valorPotencia}</td>`;
                filaBinario += `<td>${digito}</td>`;
                filaParcial += `<td class="residuo-col">${resultadoParcial}</td>`;

                if (digito === 1) {
                    decimal += valorPotencia;
                    // Construir la suma de izquierda a derecha para que el √∫ltimo t√©rmino sea la potencia de 2^0
                    sumaParcial = sumaParcial === '' ? `${valorPotencia}` : `${valorPotencia} + ${sumaParcial}`;
                }
            }
            
            // Invertir la suma parcial para que se lea de izquierda a derecha (2^n + ... + 2^0)
            const sumandos = sumaParcial.split(' + ').reverse();
            let sumaFinal = sumandos.join(' + ');
            if(sumandos.length === 1 && sumandos[0] === '') sumaFinal = '0'; // Caso de binario que solo tiene ceros

            let sumaHTML = `<p style="font-weight: bold;">Suma de valores: ${sumaFinal} = <span class="residuo-col" style="padding: 5px; border-radius: 4px; display: inline-block;">${decimal}</span></p>`;

            tablaHTML += `<div class="resultado" style="margin-bottom: 10px;">${binarioStr}<sub>(2)</sub> = ${decimal}<sub>(10)</sub></div>`;
            tablaHTML += '<p style="font-weight: bold; margin: 15px 0 5px;">Procedimiento:</p>';

            tablaHTML += '<div class="proceso-table-container">';
            tablaHTML += '<table class="bin-to-dec-table" style="min-width: 500px;">';
            tablaHTML += '<thead>' + filaPotencia + '</tr>' + filaValorPotencia + '</tr>' + filaBinario + '</tr>' + '</thead>';
            tablaHTML += '<tbody>' + filaParcial + '</tr>' + '</tbody>';
            tablaHTML += '</table>';
            tablaHTML += '</div>';

            tablaHTML += `<div style="text-align: center; margin-top: 10px;">${sumaHTML}</div>`;
            tablaHTML += '</div>';

            outputContainer.innerHTML = tablaHTML;
            actualizarResultados('binToDec');
            saveData();
        }


        // --- 3. Generar √öNICO PDF (Optimizado para evitar cortes) ---
        async function generarPDF() {
            const {
                jsPDF
            } = window.jspdf;

            const taller = document.getElementById('tallerInput').value || 'Taller sin t√≠tulo';
            const fecha = document.getElementById('fechaInput').value || new Date().toISOString().slice(0, 10);
            const institucion = document.getElementById('institucionInput').value || 'Sin instituci√≥n';
            const programa = document.getElementById('programaInput').value || 'Sin programa';
            const jornada = document.getElementById('jornadaInput').value || 'Sin jornada';
            const ciclo = document.getElementById('cicloInput').value || 'Sin ciclo';

            const integrantes = Array.from(document.querySelectorAll('.integrante-input'))
                .map(input => input.value.trim())
                .filter(name => name !== '');

            const decResults = document.getElementById('resultadosDecimalABinario').innerHTML;
            const binResults = document.getElementById('resultadosBinarioADecimal').innerHTML;

            if (integrantes.length === 0) {
                alert('‚ö†Ô∏è Por favor, ingresa al menos un nombre de integrante.');
                return;
            }

            if (!decResults && !binResults) {
                alert('‚ö†Ô∏è No hay resultados de conversi√≥n v√°lidos para generar el PDF. ¬°Calcula al menos un n√∫mero!');
                return;
            }

            const integrantList = integrantes.map(name => `<p style="margin: 5px 0;">- ${name}</p>`).join('');

            const contentHTML = document.createElement('div');
            const pdfDocument = document.createElement('div');
            pdfDocument.id = 'pdf-capture-area';
            pdfDocument.style.padding = '20mm';
            pdfDocument.style.backgroundColor = '#fff';
            pdfDocument.style.width = '190mm';
            pdfDocument.style.margin = '0 auto';
            pdfDocument.style.fontFamily = 'Arial, sans-serif';


            // Encabezado
            let finalContent = `
                <div style="margin-bottom: 20px; text-align: left;">
                    <h2 style="text-align: center; color: #333; margin-bottom: 20px;">N√öMEROS BINARIOS</h2>
                    <hr style="border-top: 2px solid #000; margin-bottom: 10px;">
                    <p style="font-weight: bold; margin: 5px 0;">Taller: <span style="font-weight: normal;">${taller}</span></p>
                    <p style="margin: 5px 0;">Fecha: <span style="font-weight: normal;">${fecha}</span></p>
                    <p style="margin: 5px 0;">Instituci√≥n: <span style="font-weight: normal;">${institucion}</span></p>
                    <p style="margin: 5px 0;">Programa: <span style="font-weight: normal;">${programa}</span></p>
                    <p style="margin: 5px 0;">Jornada: <span style="font-weight: normal;">${jornada}</span></p>
                    <p style="margin: 5px 0;">Ciclo Cursado: <span style="font-weight: normal;">${ciclo}</span></p>
                    <p style="font-weight: bold; margin-top: 15px;">Realizado Por:</p>
                    ${integrantList}
                    <hr style="border-top: 1px dashed #ccc; margin: 20px 0;">
                </div>
            `;

            // Secci√≥n Decimal a Binario
            if (decResults) {
                finalContent += `<h3 style="color: #333; margin-top: 25px; border-bottom: 1px solid #eee; padding-bottom: 5px; text-align: center;">Conversi√≥n Decimal a Binario (M√©todo de Divisiones Sucesivas)</h3>`;
                finalContent += decResults;
            }

            // Secci√≥n Binario a Decimal
            if (binResults) {
                // Forzar salto de p√°gina fuerte entre secciones grandes
                finalContent += `<div style="page-break-before: always; margin-top: 0px;"></div>`;
                finalContent += `<h3 style="color: #333; margin-top: 25px; border-bottom: 1px solid #eee; padding-bottom: 5px; text-align: center;">Conversi√≥n Binario a Decimal (Suma de Potencias)</h3>`;
                finalContent += binResults;
            }

            pdfDocument.innerHTML = finalContent;
            contentHTML.appendChild(pdfDocument);

            // Preparaci√≥n para Captura
            contentHTML.querySelectorAll('.proceso-table-container').forEach(container => {
                container.style.overflowX = 'visible';
                const table = container.querySelector('table');
                if (table) {
                    table.style.transform = 'scale(1)';
                    table.style.minWidth = '100%';
                    table.style.fontSize = '0.85em';
                }
            });

            document.body.appendChild(contentHTML);

            // Captura
            const canvas = await html2canvas(document.getElementById('pdf-capture-area'), {
                scale: 2,
                logging: false,
                useCORS: true,
                windowWidth: 1000,
                windowHeight: document.getElementById('pdf-capture-area').offsetHeight + 50
            });

            document.body.removeChild(contentHTML);

            // Generar el PDF a partir de la imagen (canvas)
            const imgData = canvas.toDataURL('image/jpeg', 1.0);

            const doc = new jsPDF('p', 'mm', 'a4');
            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = canvas.height * imgWidth / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            doc.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft > 0) {
                position = heightLeft - imgHeight;
                doc.addPage();
                doc.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            doc.save(`Taller_Conversiones_${fecha}.pdf`);
        }
    </script>
</body>

</html>
